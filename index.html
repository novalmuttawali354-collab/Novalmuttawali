<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jadwal Pasaran Togel | Neon Dashboard System</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üïπÔ∏è</text></svg>">
  <!-- Google Fonts: Orbitron & Rajdhani for Cyberpunk feel -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* ========== NEON CYBERPUNK VARIABLES ========== */
    :root {
      --bg-dark: #050508;
      --bg-panel: rgba(10, 10, 16, 0.65);
      --neon-cyan: #00f3ff;
      --neon-pink: #bc13fe;
      --neon-purple: #5e17eb;
      --neon-green: #0aff0a;
      --text-main: #e0e0ff;
      --text-dim: #8892b0;
      --glass-border: 1px solid rgba(0, 243, 255, 0.2);
      --shadow-glow: 0 0 15px rgba(0, 243, 255, 0.3);
      --font-head: 'Orbitron', sans-serif;
      --font-body: 'Rajdhani', sans-serif;
    }

    /* ========== RESET & BASE ========== */
    * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
    
    body {
      background-color: var(--bg-dark);
      color: var(--text-main);
      font-family: var(--font-body);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Scrollbar Holographic */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #020205; }
    ::-webkit-scrollbar-thumb { 
      background: linear-gradient(180deg, var(--neon-purple), var(--neon-cyan)); 
      border-radius: 4px;
    }

    /* ========== BACKGROUND ANIMATION (GRID & PARTICLES) ========== */
    .cyber-bg {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -2;
      background: 
        linear-gradient(rgba(5, 5, 8, 0.95), rgba(5, 5, 8, 0.95)),
        repeating-linear-gradient(0deg, transparent 0, transparent 1px, rgba(0, 243, 255, 0.03) 1px, rgba(0, 243, 255, 0.03) 2px),
        repeating-linear-gradient(90deg, transparent 0, transparent 1px, rgba(188, 19, 254, 0.03) 1px, rgba(188, 19, 254, 0.03) 2px);
      background-size: 100% 100%, 40px 40px, 40px 40px;
      perspective: 500px;
      transform-style: preserve-3d;
      animation: gridMove 20s linear infinite;
    }

    @keyframes gridMove {
      0% { background-position: center, 0 0, 0 0; }
      100% { background-position: center, 0 40px, 0 40px; }
    }

    .glowing-orb {
      position: fixed;
      width: 400px; height: 400px;
      border-radius: 50%;
      filter: blur(100px);
      z-index: -1;
      opacity: 0.4;
      animation: orbFloat 10s infinite ease-in-out alternate;
    }
    .orb-1 { top: -100px; left: -100px; background: var(--neon-purple); }
    .orb-2 { bottom: -100px; right: -100px; background: var(--neon-cyan); animation-delay: -5s; }

    @keyframes orbFloat {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    /* ========== LAYOUT & CONTAINERS ========== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    /* ========== HEADER (GLITCH EFFECT) ========== */
    .header {
      text-align: center;
      margin: 40px 0 50px;
      position: relative;
    }

    .header h1 {
      font-family: var(--font-head);
      font-size: 3rem;
      font-weight: 900;
      text-transform: uppercase;
      color: #fff;
      letter-spacing: 4px;
      text-shadow: 
        0 0 10px var(--neon-cyan),
        0 0 20px var(--neon-cyan),
        0 0 40px var(--neon-purple);
      position: relative;
      display: inline-block;
    }
    
    /* Subtle glitch animation */
    .header h1::before, .header h1::after {
      content: attr(data-text);
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-dark);
    }
    .header h1::before {
      left: 2px; text-shadow: -2px 0 #ff00c1; clip: rect(44px, 450px, 56px, 0);
      animation: glitch-anim 5s infinite linear alternate-reverse;
    }
    .header h1::after {
      left: -2px; text-shadow: -2px 0 #00fff9; clip: rect(44px, 450px, 56px, 0);
      animation: glitch-anim2 5s infinite linear alternate-reverse;
    }

    @keyframes glitch-anim {
      0% { clip: rect(12px, 9999px, 32px, 0); }
      100% { clip: rect(65px, 9999px, 80px, 0); }
    }
    @keyframes glitch-anim2 {
      0% { clip: rect(82px, 9999px, 92px, 0); }
      100% { clip: rect(2px, 9999px, 12px, 0); }
    }

    .header p {
      color: var(--neon-cyan);
      font-size: 1.2rem;
      margin-top: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 5px var(--neon-cyan);
    }

    /* ========== STATS CARDS (HUD STYLE) ========== */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: var(--bg-panel);
      backdrop-filter: blur(12px);
      border: var(--glass-border);
      padding: 20px;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      transition: all 0.3s ease;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 4px; height: 100%;
      background: var(--neon-cyan);
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 25px rgba(0, 243, 255, 0.2);
      border-color: var(--neon-cyan);
    }

    .stat-icon {
      width: 60px; height: 60px;
      border: 2px solid var(--neon-purple);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
      color: var(--neon-purple);
      box-shadow: 0 0 10px var(--neon-purple);
      background: rgba(94, 23, 235, 0.1);
    }

    .stat-content h3 {
      color: var(--text-dim);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-content .stat-value {
      font-family: var(--font-head);
      font-size: 1.8rem;
      color: #fff;
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    /* ========== SEARCH SECTION ========== */
    .search-container {
      background: var(--bg-panel);
      border: var(--glass-border);
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 40px;
      position: relative;
      backdrop-filter: blur(12px);
    }

    .search-container::after {
      content: "SEARCH_SYSTEM_V.2.0";
      position: absolute;
      top: -10px; right: 20px;
      background: var(--bg-dark);
      color: var(--neon-pink);
      padding: 0 10px;
      font-size: 0.7rem;
      font-family: var(--font-head);
      border: 1px solid var(--neon-pink);
    }

    .search-box {
      display: flex; gap: 15px;
    }

    .search-input-wrapper {
      flex: 1; position: relative;
    }

    .search-input {
      width: 100%;
      background: rgba(0,0,0,0.5);
      border: 1px solid #333;
      color: var(--neon-cyan);
      padding: 15px 20px;
      font-family: var(--font-body);
      font-size: 1.1rem;
      border-radius: 4px;
      transition: 0.3s;
    }

    .search-input:focus {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
    }

    .search-btn {
      background: linear-gradient(45deg, var(--neon-purple), var(--neon-pink));
      border: none;
      color: white;
      padding: 0 30px;
      font-family: var(--font-head);
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      border-radius: 4px;
      transition: 0.3s;
      letter-spacing: 1px;
    }

    .search-btn:hover {
      box-shadow: 0 0 20px var(--neon-pink);
      filter: brightness(1.2);
    }

    /* ========== TABLE (DATA HUD) ========== */
    .table-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;
    }

    .table-header h2 {
      font-family: var(--font-head);
      color: #fff;
      text-shadow: 0 0 10px var(--neon-cyan);
    }

    .table-container {
      background: var(--bg-panel);
      border: var(--glass-border);
      border-radius: 12px;
      overflow: hidden;
      backdrop-filter: blur(12px);
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
    }

    table { width: 100%; border-collapse: collapse; min-width: 800px; }

    thead {
      background: rgba(0, 243, 255, 0.1);
      border-bottom: 2px solid var(--neon-cyan);
    }

    th {
      padding: 20px;
      text-align: left;
      color: var(--neon-cyan);
      font-family: var(--font-head);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    td {
      padding: 18px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      color: var(--text-main);
      font-weight: 500;
    }

    tr:hover {
      background: rgba(188, 19, 254, 0.1);
    }

    /* Table Links */
    .link {
      display: inline-flex; align-items: center; gap: 8px;
      color: var(--neon-pink);
      text-decoration: none;
      padding: 8px 16px;
      border: 1px solid var(--neon-pink);
      border-radius: 4px;
      transition: 0.3s;
      text-transform: uppercase;
      font-size: 0.8rem;
      font-weight: 700;
    }

    .link:hover {
      background: var(--neon-pink);
      color: #fff;
      box-shadow: 0 0 15px var(--neon-pink);
    }

    .copy-btn {
      background: transparent;
      border: 1px solid var(--neon-cyan);
      color: var(--neon-cyan);
      width: 35px; height: 35px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
      transition: 0.3s;
    }

    .copy-btn:hover {
      background: var(--neon-cyan);
      color: #000;
      box-shadow: 0 0 15px var(--neon-cyan);
    }

    /* ========== NOTIFICATION BAR ========== */
    .next-result-notification {
      background: rgba(5, 5, 8, 0.9);
      border: 1px solid var(--neon-green);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 20px rgba(10, 255, 10, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    /* Scanning line effect */
    .next-result-notification::after {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 2px;
      background: var(--neon-green);
      box-shadow: 0 0 10px var(--neon-green);
      animation: scan 2s linear infinite;
    }

    @keyframes scan {
      0% { top: 0; opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { top: 100%; opacity: 0; }
    }

    .notification-pasaran { color: var(--neon-green); font-weight: 700; text-shadow: 0 0 5px var(--neon-green); }
    .notification-countdown { 
      font-family: var(--font-head); 
      font-size: 1.5rem; 
      color: #fff; 
      text-shadow: 0 0 10px var(--neon-green);
      border-left: 1px solid var(--neon-green);
      padding-left: 20px;
      margin-left: 20px;
    }

    /* ========== ACTION BUTTONS ========== */
    .table-action-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--text-dim);
      color: var(--text-main);
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 4px;
      font-family: var(--font-body);
      font-weight: 600;
      transition: 0.3s;
      display: flex; align-items: center; gap: 8px;
    }

    .table-action-btn:hover {
      border-color: var(--neon-cyan);
      color: var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
    }

    /* ========== LOADING & ERROR STATES ========== */
    .loading, .error {
      text-align: center;
      padding: 60px;
      background: var(--bg-panel);
      border: var(--glass-border);
      border-radius: 12px;
      margin: 20px 0;
    }

    .loading-spinner {
      width: 60px; height: 60px;
      border: 3px solid rgba(0, 243, 255, 0.1);
      border-top: 3px solid var(--neon-cyan);
      border-radius: 50%;
      margin: 0 auto 20px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* ========== SILENT UPDATE INDICATOR ========== */
    .silent-update-indicator {
      position: fixed; top: 20px; right: 20px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--neon-green);
      color: var(--neon-green);
      padding: 8px 15px;
      border-radius: 4px;
      font-family: var(--font-head);
      font-size: 0.8rem;
      z-index: 100;
      display: flex; align-items: center; gap: 8px;
      box-shadow: 0 0 15px rgba(10, 255, 10, 0.2);
      transform: translateX(200%);
      transition: transform 0.5s ease;
    }
    .silent-update-indicator.show { transform: translateX(0); }
    .silent-pulse { width: 8px; height: 8px; background: var(--neon-green); border-radius: 50%; box-shadow: 0 0 10px var(--neon-green); animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }

    /* ========== NOTIFICATION TOAST ========== */
    .notification-toast {
      position: fixed; top: 80px; right: 20px;
      background: rgba(5, 5, 8, 0.95);
      border-left: 4px solid var(--neon-cyan);
      padding: 15px 25px;
      border-radius: 4px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      z-index: 1000;
      color: #fff;
      font-family: var(--font-body);
      animation: slideInRight 0.5s forwards;
    }
    @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }

    /* ========== FOOTER ========== */
    .footer {
      text-align: center;
      margin-top: 50px;
      padding: 30px;
      border-top: 1px solid rgba(255,255,255,0.1);
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header h1 { font-size: 2rem; }
      .search-box { flex-direction: column; }
      .next-result-notification { flex-direction: column; text-align: center; gap: 15px; }
      .notification-countdown { border-left: none; padding-left: 0; margin-left: 0; border-top: 1px solid var(--neon-green); padding-top: 15px; width: 100%; }
    }
  </style>
</head>
<body>
  
  <!-- Background Elements -->
  <div class="cyber-bg"></div>
  <div class="glowing-orb orb-1"></div>
  <div class="glowing-orb orb-2"></div>
  
  <!-- Silent Update Indicator (Custom Style) -->
  <div class="silent-update-indicator" id="silent-update-indicator">
    <div class="silent-pulse"></div>
    <span>SYSTEM UPDATED</span>
  </div>

  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1 data-text="TOGEL SCHEDULE">TOGEL SCHEDULE</h1>
      <p><i class="fas fa-satellite-dish"></i> LIVE DATA FEED // REAL-TIME MONITORING</p>
    </header>
    
    <!-- Stats Cards -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-database"></i></div>
        <div class="stat-content">
          <h3>Total Pasaran</h3>
          <div class="stat-value" id="total-pasaran">0</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-video"></i></div>
        <div class="stat-content">
          <h3>Live Streams</h3>
          <div class="stat-value" id="live-streams">0</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-sync-alt"></i></div>
        <div class="stat-content">
          <h3>Last Update</h3>
          <div class="stat-value" id="last-update">--:--</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-clock"></i></div>
        <div class="stat-content">
          <h3>Next Result</h3>
          <div class="stat-value" id="next-result-time">--:--</div>
        </div>
      </div>
    </div>
    
    <!-- Next Result Notification -->
    <div id="next-result-notification" class="next-result-notification" style="display:none;">
      <div style="display:flex; align-items:center; gap:15px;">
        <i class="fas fa-exclamation-triangle" style="color:var(--neon-green); font-size:1.5rem; animation: blink 1s infinite;"></i>
        <div>
          <div style="font-size:0.9rem; color:var(--text-dim); text-transform:uppercase;">Upcoming Result</div>
          <div style="font-size:1.2rem;">
            <span class="notification-pasaran" id="notification-pasaran">-</span> 
            <span style="color:#fff; font-size:0.9rem;">at</span> 
            <span style="color:#fff;" id="notification-time">-</span>
          </div>
        </div>
      </div>
      <div class="notification-countdown" id="notification-countdown">00:00:00</div>
    </div>
    
    <!-- Search Section -->
    <div class="search-container">
      <div class="search-box">
        <div class="search-input-wrapper">
          <input type="text" id="search-input" class="search-input" placeholder="ENTER QUERY TO SEARCH DATABASE..." autocomplete="off">
          <button id="clear-btn" class="copy-btn" style="position:absolute; right:10px; top:10px; display:none; border:none;"><i class="fas fa-times"></i></button>
        </div>
        <button id="search-btn" class="search-btn"><i class="fas fa-search"></i> SCAN</button>
      </div>
      <div id="search-result-info" style="display:none; margin-top:15px; padding:10px; border:1px dashed var(--neon-pink); color:var(--neon-pink); font-size:0.9rem;">
        RESULTS FOUND: <span id="result-count">0</span> FOR "<span id="search-query"></span>"
        <button id="reset-search-btn" style="background:transparent; border:none; color:var(--text-dim); cursor:pointer; margin-left:10px; text-decoration:underline;">[RESET]</button>
      </div>
    </div>
    
    <!-- Loading -->
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <h2 style="font-family:var(--font-head); color:var(--neon-cyan);">INITIALIZING SYSTEM...</h2>
      <p style="color:var(--text-dim);">CONNECTING TO SECURE DATA STREAM</p>
    </div>
    
    <!-- Error -->
    <div id="error" class="error" style="display:none; border-color: #ff3333;">
      <i class="fas fa-skull-crossbones" style="font-size:3rem; color:#ff3333; margin-bottom:20px;"></i>
      <h2 style="color:#ff3333; font-family:var(--font-head);">CONNECTION FAILED</h2>
      <p id="error-message" style="color:#fff; margin:10px 0;">Error establishing link.</p>
      <button onclick="loadData()" style="background:var(--neon-purple); border:none; padding:10px 20px; color:#fff; cursor:pointer; font-weight:bold; margin-top:10px;">RETRY CONNECTION</button>
    </div>
    
    <!-- Table Section -->
    <div id="table-section" class="table-section" style="display:none;">
      <div class="table-header">
        <h2><i class="fas fa-table"></i> DATABASE</h2>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button id="refresh-btn" class="table-action-btn"><i class="fas fa-sync"></i> REFRESH</button>
          <button id="export-btn" class="table-action-btn"><i class="fas fa-download"></i> EXPORT</button>
        </div>
      </div>
      
      <div class="table-container">
        <table id="jadwal-table">
          <thead>
            <tr id="table-header"></tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
      <p>¬© 2025 NEON TOGEL SYSTEM // SECURE CONNECTION ESTABLISHED</p>
      <p style="font-size:0.8rem; opacity:0.6; margin-top:10px;">LAST SYNC: <span id="footer-update">-</span></p>
    </footer>
  </div>

  <script>
    // ========== KONFIGURASI GOOGLE SHEETS (ORIGINAL LOGIC PRESERVED) ==========
    const SPREADSHEET_ID = '10LXglc7cEh3MhS9CStG5sEazXz-G6dKpXP_8vTLAW-c';
    const SHEET_NAME = 'Jadwal Pasaran';
    
    // ========== VARIABEL GLOBAL ==========
    let allData = [];
    let filteredData = [];
    let headers = [];
    let lastDataHash = '';
    let realTimeInterval;
    let currentDataVersion = 0;
    let isFirstLoad = true;
    
    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
      console.log('System Neon: Starting...');
      
      setupEventListeners();
      loadData();
      startSilentMonitoring();
    });
    
    // ========== SILENT MONITORING SYSTEM ==========
    function startSilentMonitoring() {
      if (realTimeInterval) clearInterval(realTimeInterval);
      realTimeInterval = setInterval(() => {
        checkForUpdatesSilently();
      }, 3000);
      console.log('System Neon: Silent Monitoring Active (3s interval)');
    }
    
    async function checkForUpdatesSilently() {
      try {
        const timestamp = new Date().getTime();
        const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}&t=${timestamp}`;
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 8000);
        
        const response = await fetch(url, { signal: controller.signal, cache: 'no-store' });
        clearTimeout(timeoutId);
        
        if (!response.ok) return;
        
        const text = await response.text();
        const json = parseGoogleSheetsResponse(text);
        const newDataHash = generateDataHash(json);
        
        if (newDataHash !== lastDataHash) {
          console.log('Neon System: Data change detected. Updating...');
          processDataSilently(json);
          lastDataHash = newDataHash;
          showSilentUpdateIndicator();
          updateLastUpdateTime();
        }
      } catch (error) {
        // Silent fail
      }
    }
    
    function showSilentUpdateIndicator() {
      const indicator = document.getElementById('silent-update-indicator');
      indicator.classList.add('show');
      setTimeout(() => indicator.classList.remove('show'), 2000);
    }
    
    function updateLastUpdateTime() {
      const now = new Date();
      const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                      now.getMinutes().toString().padStart(2, '0') + ':' + 
                      now.getSeconds().toString().padStart(2, '0');
      
      // Visual update of time in specific element if needed
      const lastUpdateEl = document.getElementById('last-update');
      if(lastUpdateEl) lastUpdateEl.textContent = timeStr;
    }
    
    function generateDataHash(json) {
      try {
        if (!json || !json.table || !json.table.rows) return '';
        const rows = json.table.rows;
        let hashString = '';
        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          if (row && row.c) {
            for (let j = 0; j < row.c.length; j++) {
              const cell = row.c[j];
              if (cell) {
                if (cell.v !== undefined && cell.v !== null) hashString += String(cell.v);
                if (cell.f) hashString += String(cell.f);
              }
            }
          }
        }
        let hash = 0;
        for (let i = 0; i < hashString.length; i++) {
          const char = hashString.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        return hash.toString();
      } catch (error) {
        return '';
      }
    }
    
    // ========== LOAD DATA ==========
    async function loadData() {
      if (isFirstLoad) {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('error').style.display = 'none';
        document.getElementById('table-section').style.display = 'none';
        document.getElementById('next-result-notification').style.display = 'none';
      }
      
      try {
        const timestamp = new Date().getTime();
        const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}&t=${timestamp}`;
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 15000);
        
        const response = await fetch(url, { signal: controller.signal, cache: 'no-store' });
        clearTimeout(timeoutId);
        
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        const text = await response.text();
        const json = parseGoogleSheetsResponse(text);
        processGoogleSheetsData(json);
        lastDataHash = generateDataHash(json);
        isFirstLoad = false;
        
      } catch (error) {
        console.error('Load Error:', error);
        showError(error);
      }
    }
    
    function parseGoogleSheetsResponse(text) {
      try {
        const jsonString = text.substring(47).slice(0, -2);
        return JSON.parse(jsonString);
      } catch (error) {
        throw new Error('Invalid Google Sheets Format');
      }
    }
    
    // ========== PROCESS DATA ==========
    function processGoogleSheetsData(json) {
      if (!json || !json.table || !json.table.rows) throw new Error('No data found');
      
      const firstRow = json.table.rows[0];
      const extractedHeaders = [];
      
      if (firstRow && firstRow.c) {
        for (let i = 0; i < firstRow.c.length; i++) {
          const cell = firstRow.c[i];
          let headerValue = (cell && cell.v !== undefined && cell.v !== null) ? String(cell.v).trim() : `Col ${i+1}`;
          if (!headerValue) {
            const defaults = ['Pasaran', 'Jam Buka', 'Jam Tutup', 'Jam Result', 'Link Resmi', 'Link YouTube'];
            headerValue = defaults[i] || `Col ${i+1}`;
          }
          extractedHeaders.push(headerValue);
        }
      }
      
      const extractedData = [];
      for (let i = 1; i < json.table.rows.length; i++) {
        const row = json.table.rows[i];
        if (!row || !row.c) continue;
        
        const rowData = {};
        let isEmptyRow = true;
        
        for (let j = 0; j < extractedHeaders.length; j++) {
          const header = extractedHeaders[j];
          const cell = row.c[j];
          let cellValue = '';
          
          if (cell) {
            if (cell.v !== undefined && cell.v !== null && cell.v !== '') {
              cellValue = String(cell.v).trim();
              isEmptyRow = false;
            }
            if (cell.f && !cellValue) {
              cellValue = String(cell.f).trim();
              isEmptyRow = false;
            }
          }
          rowData[header] = cellValue;
        }
        
        if (!isEmptyRow) extractedData.push(rowData);
      }
      
      allData = extractedData;
      filteredData = [...allData];
      headers = extractedHeaders;
      
      updateStats();
      renderTable();
      setupNextResultNotification();
      
      if (isFirstLoad) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('table-section').style.display = 'block';
      }
      
      const now = new Date();
      document.getElementById('footer-update').textContent = now.toLocaleString('id-ID');
      updateLastUpdateTime();
    }
    
    // ========== SILENT DATA PROCESS ==========
    function processDataSilently(json) {
      if (!json || !json.table || !json.table.rows) return;
      
      currentDataVersion++;
      const firstRow = json.table.rows[0];
      const extractedHeaders = [];
      
      if (firstRow && firstRow.c) {
        for (let i = 0; i < firstRow.c.length; i++) {
          const cell = firstRow.c[i];
          let headerValue = (cell && cell.v !== undefined) ? String(cell.v).trim() : `Col ${i+1}`;
          if (!headerValue) headerValue = ['Pasaran', 'Jam Buka', 'Jam Tutup', 'Jam Result', 'Link Resmi', 'Link YouTube'][i] || `Col ${i+1}`;
          extractedHeaders.push(headerValue);
        }
      }
      
      const extractedData = [];
      for (let i = 1; i < json.table.rows.length; i++) {
        const row = json.table.rows[i];
        if (!row || !row.c) continue;
        const rowData = {};
        let isEmptyRow = true;
        for (let j = 0; j < extractedHeaders.length; j++) {
          const cell = row.c[j];
          let val = '';
          if (cell) {
            if (cell.v !== undefined && cell.v !== '') { val = String(cell.v).trim(); isEmptyRow = false; }
            else if (cell.f) { val = String(cell.f).trim(); isEmptyRow = false; }
          }
          rowData[extractedHeaders[j]] = val;
        }
        if (!isEmptyRow) extractedData.push(rowData);
      }
      
      const oldData = [...allData];
      allData = extractedData;
      headers = extractedHeaders;
      
      const query = document.getElementById('search-input').value.trim().toLowerCase();
      if (query) {
        filteredData = allData.filter(row => Object.values(row).some(v => String(v).toLowerCase().includes(query)));
      } else {
        filteredData = [...allData];
      }
      
      updateStatsSilently();
      updateTableSilently(oldData);
      setupNextResultNotification();
    }
    
    function updateStatsSilently() {
      document.getElementById('total-pasaran').textContent = allData.length;
      const liveStreams = allData.filter(item => {
        const yt = item['Link YouTube'] || item['Link Youtube'] || item['YouTube'] || item['Youtube'];
        return yt && yt.trim() !== '' && yt !== '-';
      }).length;
      document.getElementById('live-streams').textContent = liveStreams;
      
      const now = new Date();
      const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
      document.getElementById('last-update').textContent = timeStr;
      
      const nextResult = findNextResult();
      document.getElementById('next-result-time').textContent = nextResult ? nextResult.time : '--:--';
      document.getElementById('footer-update').textContent = now.toLocaleString('id-ID');
      updateLastUpdateTime();
    }
    
    function updateTableSilently(oldData) {
      const tableBody = document.getElementById('table-body');
      const scrollTop = document.querySelector('.table-container').scrollTop;
      
      tableBody.innerHTML = '';
      
      if (filteredData.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = headers.length;
        td.textContent = 'NO DATA FOUND';
        td.style.textAlign = 'center';
        td.style.padding = '40px';
        td.style.color = 'var(--text-dim)';
        tr.appendChild(td);
        tableBody.appendChild(tr);
      } else {
        filteredData.forEach((rowData, index) => {
          const row = document.createElement('tr');
          const isNew = !oldData.some(old => JSON.stringify(old) === JSON.stringify(rowData));
          if(isNew && index < allData.length - oldData.length) {
             row.style.backgroundColor = 'rgba(10, 255, 10, 0.2)';
             setTimeout(() => row.style.backgroundColor = '', 2000);
          }

          headers.forEach(header => {
            const cell = document.createElement('td');
            const val = rowData[header] || '-';
            
            if (header.toLowerCase().includes('link') || header.toLowerCase().includes('youtube') || header.toLowerCase().includes('url')) {
              const div = document.createElement('div');
              div.style.display = 'flex'; div.style.alignItems = 'center';
              
              if (isValidUrl(val) && val !== '-') {
                const a = document.createElement('a');
                a.href = val; a.target = '_blank'; a.rel = 'noopener';
                a.className = 'link';
                a.innerHTML = header.toLowerCase().includes('youtube') ? '<i class="fab fa-youtube"></i> LIVE' : '<i class="fas fa-external-link-alt"></i> LINK';
                div.appendChild(a);
                
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerHTML = '<i class="fas fa-copy"></i>';
                btn.onclick = function() {
                  copyToClipboard(val);
                  const original = this.innerHTML;
                  this.innerHTML = '<i class="fas fa-check"></i>';
                  this.style.borderColor = 'var(--neon-green)';
                  this.style.color = 'var(--neon-green)';
                  setTimeout(() => {
                    this.innerHTML = original;
                    this.style.borderColor = ''; this.style.color = '';
                  }, 2000);
                };
                div.appendChild(btn);
              } else {
                cell.textContent = val;
              }
              if(div.children.length > 0) cell.appendChild(div);
            } else {
              cell.textContent = val;
            }
            row.appendChild(cell);
          });
          tableBody.appendChild(row);
        });
      }
      
      document.querySelector('.table-container').scrollTop = scrollTop;
    }
    
    // ========== STATS & NOTIFICATIONS ==========
    function updateStats() {
      document.getElementById('total-pasaran').textContent = allData.length;
      const live = allData.filter(item => {
        const yt = item['Link YouTube'] || item['Link Youtube'] || item['YouTube'];
        return yt && yt.trim() !== '' && yt !== '-';
      }).length;
      document.getElementById('live-streams').textContent = live;
      
      const now = new Date();
      const t = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
      document.getElementById('last-update').textContent = t;
      
      const nr = findNextResult();
      document.getElementById('next-result-time').textContent = nr ? nr.time : '--:--';
    }
    
    function setupNextResultNotification() {
      const next = findNextResult();
      const el = document.getElementById('next-result-notification');
      if (next) {
        document.getElementById('notification-pasaran').textContent = next.pasaran;
        document.getElementById('notification-time').textContent = next.time;
        el.style.display = 'flex';
        updateCountdown(next);
      } else {
        el.style.display = 'none';
      }
    }
    
    function findNextResult() {
      const now = new Date();
      const currentMin = now.getHours() * 60 + now.getMinutes();
      let next = null;
      let minDiff = Infinity;
      
      allData.forEach(p => {
        let t = '';
        const cols = ['Jam Result', 'Jam Keluar', 'Result', 'Jam'];
        for(let c of cols) { if(p[c] && p[c].trim() !== '' && p[c] !== '-') { t = p[c]; break; } }
        if(!t) return;
        
        let h, m;
        if(t.includes(':')) [h, m] = t.split(':').map(Number);
        else if(t.includes('.')) [h, m] = t.split('.').map(Number);
        else {
          const n = parseInt(t); if(!isNaN(n)) { h = Math.floor(n/100); m = n%100; } else return;
        }
        if(isNaN(h) || isNaN(m)) return;
        
        const resMin = h * 60 + m;
        let diff = resMin - currentMin;
        if(diff < 0) diff += 24*60;
        
        if(diff > 0 && diff < minDiff) {
          minDiff = diff;
          next = { pasaran: p[headers[0]] || 'Unknown', time: `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}` };
        }
      });
      return next;
    }
    
    function updateCountdown(next) {
      function tick() {
        const n = new Date();
        const cur = n.getHours()*3600 + n.getMinutes()*60 + n.getSeconds();
        const [h, m] = next.time.split(':').map(Number);
        let target = h*3600 + m*60;
        if(target <= cur) target += 24*3600;
        
        let diff = target - cur;
        const hh = Math.floor(diff/3600);
        const mm = Math.floor((diff%3600)/60);
        const ss = diff%60;
        
        document.getElementById('notification-countdown').textContent = 
          `${hh.toString().padStart(2,'0')}:${mm.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;
      }
      tick(); setInterval(tick, 1000);
    }
    
    // ========== RENDER TABLE ==========
    function renderTable() {
      const th = document.getElementById('table-header');
      const tb = document.getElementById('table-body');
      th.innerHTML = ''; tb.innerHTML = '';
      
      headers.forEach(h => {
        const e = document.createElement('th'); e.textContent = h; th.appendChild(e);
      });
      
      if (filteredData.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = headers.length;
        td.textContent = 'DATA NOT FOUND IN DATABASE';
        td.style.textAlign = 'center'; td.style.padding = '40px'; td.style.color = 'var(--text-dim)';
        tr.appendChild(td); tb.appendChild(tr);
      } else {
        filteredData.forEach((row, idx) => {
          const tr = document.createElement('tr');
          headers.forEach(hdr => {
            const td = document.createElement('td');
            const v = row[hdr] || '-';
            
            if (hdr.toLowerCase().includes('link') || hdr.toLowerCase().includes('youtube') || hdr.toLowerCase().includes('url')) {
              const d = document.createElement('d');
              d.style.display = 'flex'; d.style.alignItems = 'center';
              
              if (isValidUrl(v) && v !== '-') {
                const a = document.createElement('a');
                a.href = v; a.target = '_blank'; a.rel = 'noopener'; a.className = 'link';
                a.innerHTML = hdr.toLowerCase().includes('youtube') ? '<i class="fab fa-youtube"></i> LIVE' : '<i class="fas fa-external-link-alt"></i> LINK';
                d.appendChild(a);
                
                const b = document.createElement('button');
                b.className = 'copy-btn';
                b.innerHTML = '<i class="fas fa-copy"></i>';
                b.onclick = function() {
                  copyToClipboard(v);
                  this.innerHTML = '<i class="fas fa-check"></i>';
                  this.style.borderColor = 'var(--neon-green)';
                  this.style.color = 'var(--neon-green)';
                  setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-copy"></i>';
                    this.style.borderColor = ''; this.style.color = '';
                  }, 2000);
                };
                d.appendChild(b);
              } else td.textContent = v;
              if(d.children.length > 0) td.appendChild(d);
            } else td.textContent = v;
            tr.appendChild(td);
          });
          tb.appendChild(tr);
        });
      }
    }
    
    // ========== SEARCH & UTILS ==========
    function setupEventListeners() {
      const inp = document.getElementById('search-input');
      const btn = document.getElementById('search-btn');
      const clr = document.getElementById('clear-btn');
      const rst = document.getElementById('reset-search-btn');
      
      btn.addEventListener('click', performSearch);
      inp.addEventListener('keyup', e => { if(e.key === 'Enter') performSearch(); });
      inp.addEventListener('input', function() {
        if(this.value.trim().length > 0) clr.style.display = 'block';
        else { clr.style.display = 'none'; resetSearch(); }
      });
      clr.addEventListener('click', () => { inp.value = ''; clr.style.display = 'none'; resetSearch(); });
      if(rst) rst.addEventListener('click', resetSearch);
      
      document.getElementById('refresh-btn').addEventListener('click', () => { loadData(); showNotification('Refreshing database...', 'info'); });
      document.getElementById('export-btn').addEventListener('click', exportData);
    }
    
    function performSearch() {
      const q = document.getElementById('search-input').value.trim().toLowerCase();
      if(!q) { resetSearch(); return; }
      filteredData = allData.filter(row => Object.values(row).some(v => String(v).toLowerCase().includes(q)));
      
      document.getElementById('result-count').textContent = filteredData.length;
      document.getElementById('search-query').textContent = q;
      document.getElementById('search-result-info').style.display = 'block';
      renderTable();
    }
    
    function resetSearch() {
      document.getElementById('search-input').value = '';
      filteredData = [...allData];
      document.getElementById('search-result-info').style.display = 'none';
      document.getElementById('clear-btn').style.display = 'none';
      renderTable();
    }
    
    function isValidUrl(s) {
      try { new URL(s); return true; } catch { return false; }
    }
    
    function copyToClipboard(txt) {
      navigator.clipboard.writeText(txt).then(() => showNotification('Data copied to clipboard', 'success'))
        .catch(() => showNotification('Failed to copy', 'error'));
    }
    
    function showError(e) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('table-section').style.display = 'none';
      document.getElementById('error-message').textContent = e.message || 'System Error';
      document.getElementById('error').style.display = 'block';
    }
    
    function showNotification(msg, type) {
      const t = document.createElement('div');
      t.className = 'notification-toast';
      t.style.borderLeftColor = type === 'error' ? 'var(--neon-pink)' : 'var(--neon-green)';
      t.innerHTML = `<i class="fas ${type==='error'?'fa-times-circle':'fa-check-circle'}"></i> ${msg}`;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 3000);
    }
    
    function exportData() {
      if(filteredData.length === 0) return showNotification('No data to export', 'error');
      const csv = [headers.join(','), ...filteredData.map(r => headers.map(h => {
        const v = String(r[h]||'').replace(/"/g, '""');
        return v.includes(',') ? `"${v}"` : v;
      }).join(','))].join('\n');
      
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `neon_data_${Date.now()}.csv`;
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
      showNotification('Database exported successfully', 'success');
    }
    
    // ========== SHORTCUT BLOCKER (PRESERVED) ==========
    const shortcut = {
      all_shortcuts: {}, add: function(combo, callback, options) {
        const defaultOpts = { type: "keydown", propagate: false, disable_in_input: false, target: document, keycode: false };
        const settings = Object.assign({}, defaultOpts, options || {});
        const target = typeof settings.target === "string" ? document.getElementById(settings.target) : settings.target;
        combo = combo.toLowerCase();
        const handler = function(e) {
          e = e || window.event;
          if (settings.disable_in_input) {
            let el = e.target || e.srcElement; if (el.nodeType === 3) el = el.parentNode;
            if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") return;
          }
          const code = e.keyCode || e.which; let key = String.fromCharCode(code).toLowerCase();
          if (code === 188) key = ","; if (code === 190) key = ".";
          const keys = combo.split("+"); let matchCount = 0;
          const specialKeys = { esc:27, escape:27, tab:9, space:32, return:13, enter:13, backspace:8, left:37, up:38, right:39, down:40, f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123 };
          let ctrlReq=false, shiftReq=false, altReq=false, metaReq=false;
          let ctrl=e.ctrlKey, shift=e.shiftKey, alt=e.altKey, meta=e.metaKey;
          for (let i=0; i<keys.length; i++) {
            const k = keys[i];
            if (k === "ctrl" || k === "control") { ctrlReq = true; matchCount++; }
            else if (k === "shift") { shiftReq = true; matchCount++; }
            else if (k === "alt") { altReq = true; matchCount++; }
            else if (k === "meta") { metaReq = true; matchCount++; }
            else if (k.length > 1) { if (specialKeys[k] === code) matchCount++; }
            else if (settings.keycode ? settings.keycode === code : key === k) { matchCount++; }
          }
          if (matchCount === keys.length && ctrl === ctrlReq && shift === shiftReq && alt === altReq && meta === metaReq) {
            callback(e); if (!settings.propagate) { e.cancelBubble = true; e.returnValue = false; if (e.stopPropagation) e.stopPropagation(); if (e.preventDefault) e.preventDefault(); return false; }
          }
        };
        this.all_shortcuts[combo] = { callback: handler, target, event: settings.type };
        target.addEventListener(settings.type, handler, false);
      }
    };
    function doNothing(e) { console.log("Shortcut Blocked: " + (e.key || e.keyCode)); }
    function setupShortcuts() {
      shortcut.add("Ctrl+U", doNothing);
      shortcut.add("f12", doNothing);
      shortcut.add("Ctrl+Shift+I", doNothing);
      shortcut.add("Ctrl+Shift+J", doNothing);
      shortcut.add("Ctrl+Shift+C", doNothing);
    }
    setupShortcuts();
    document.addEventListener('keydown', function(e) {
      if(e.keyCode === 123) { e.preventDefault(); return false; }
      if(e.ctrlKey && e.shiftKey && e.keyCode === 73) { e.preventDefault(); return false; }
      if(e.ctrlKey && e.shiftKey && e.keyCode === 74) { e.preventDefault(); return false; }
      if(e.ctrlKey && e.shiftKey && e.keyCode === 67) { e.preventDefault(); return false; }
      if(e.ctrlKey && e.keyCode === 85) { e.preventDefault(); return false; }
      if(e.ctrlKey && e.keyCode === 83) { e.preventDefault(); return false; }
    });
    document.addEventListener('contextmenu', function(e) { e.preventDefault(); return false; });
    document.addEventListener('selectstart', function(e) { e.preventDefault(); return false; });
  </script>
</body>
</html>
